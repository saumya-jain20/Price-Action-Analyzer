import pandas as pd
import numpy as np
import asyncio

df = pd.read_csv('BTCData.csv')
df.columns = ['Date','Open','High','Low','Close','Volume']
df['Date'] = pd.to_datetime(df['Date'])
df['Date'] = df['Date'].apply(lambda x: x.timestamp())
# print(df)
'''
The above data is in the required format 
 Columns : Date,Open,High, Low,Close,Volume
        Date        Open        High         Low       Close       Volume
0   1.514768e+09  727.029312  731.987082  716.852963  718.015406  2320.961658
1   1.514772e+09  717.704599  725.801211  717.624823  724.105981  2172.553573
2   1.514776e+09  723.950227  738.017332  722.596765  734.479535  2170.776746
3   1.514779e+09  734.967702  744.975621  729.936353  744.816336  2345.819307
4   1.514783e+09  744.779836  749.998738  742.080404  748.988951  2289.674144
5   1.514786e+09  748.904965  762.167509  746.207734  762.167509  2506.699413
6   1.514790e+09  762.169524  763.555547  750.000000  752.005490  2365.723581
7   1.514794e+09  751.803148  758.136184  737.459277  745.060004  2388.807283
8   1.514797e+09  744.075414  754.993630  744.075414  753.203923  1817.902393
9   1.514801e+09  754.178568  759.020597  749.963143  757.122656  1621.628856
10  1.514804e+09  757.043962  758.032405  730.596883  741.048870  3122.487655
11  1.514808e+09  741.028655  748.860592  737.713564  745.068477  2268.495186
12  1.514812e+09  746.488317  747.100408  729.759428  738.989551  2722.901973
13  1.514815e+09  738.964788  744.637247  724.144490  742.709810  3776.662779
14  1.514819e+09  742.341154  752.293716  738.313565  748.834377  2542.060388
15  1.514822e+09  748.295758  748.956351  732.971429  739.147956  1892.166211
16  1.514826e+09  739.372577  747.283819  735.651399  737.076876  2251.806853
17  1.514830e+09  737.023242  743.719153  734.026573  743.033234  1634.229340
18  1.514833e+09  743.054835  750.291417  741.660919  746.564764  2009.833483
'''

list_of_dicts = df.to_dict(orient='records')

import json
# Specify the file path
file_path = 'data.json'

# Open the file in write mode and write the JSON data
with open(file_path, 'w') as json_file:
    json.dump(list_of_dicts, json_file, indent=4)

from impulse import get_impulses

async def main():
    result = await get_impulses(df)
    print(len(result))

# Running the async main function
asyncio.run(main())